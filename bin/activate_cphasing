#!/bin/bash

# This script activates the cphasing environment by pixi 

if [ -f $HOME/.pixi/bin/pixi ]; then
    export PATH=$HOME/.pixi/bin:$PATH
fi

if ! command -v pixi &> /dev/null
then
    echo "pixi could not be found, installing pixi..."
    curl -fsSL https://pixi.sh/install.sh | bash
fi


software_dir="$(dirname "$(dirname "$0")")"

if [ -d $software_dir/.pixi/envs/default/bin/ ]; then
    echo
else
    echo "Installing cphasing environment..."
    pixi install --manifest-path $software_dir/pixi.toml
fi

export LD_LIBRARY_PATH="$software_dir/.pixi/envs/default/lib:$LD_LIBRARY_PATH"
export PATH=$software_dir/bin:$PATH
export PYTHONPATH=$software_dir:$PYTHONPATH

pixi shell --manifest-path $software_dir/pixi.toml --no-install --change-ps1 false


